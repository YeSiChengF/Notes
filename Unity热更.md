# Unity热更

主要流程：

1. 设置热更配表数据结构
2. 生成热更包及热更配表放到服务器
3. 下载热更配置表读取需要热更文件
4. 下载热更文件
5. 游戏中加载热更

## ILRunTime

ios不支持dll热更

### 基本概念

#### 域

使用热更后，在游戏中存在两个域，一个是游戏主程序，另一个是热更域

#### CLR

C#的公共运行库，公共运行环境

#### Assembly-CSharp.dll

unity编译的dll文件，非特殊目录下的脚本都存放在这，安卓可通过反射获取方法和变量

#### dll

热更工程生成的dll，主工程的代码不能热更，只有热更工程的才能热更

### 热更原理

 ILRuntime借助Mono.Cecil库来读取DLL的PE信息，以及当中类型的所有信息，最终得到方法的IL汇编码，然后通过内置的IL解译执行虚拟机来执行DLL中的代码。IL解释器代码在ILIntepreter.cs，通过Opcode来逐语句执行机器码，解释器的代码有四千多行。 

 ![img](https://img2018.cnblogs.com/blog/363476/201901/363476-20190115203700346-1102207440.png) 